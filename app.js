import{db as e}from"./firebase-init.js";import{collection as t,addDoc as n,getDocs as s,query as d,where as o}from"https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";let currentUser=null,isLoggedIn=!1,currentAuthMode="login",btcPrice=0;async function fetchBitcoinPrice(){try{let e=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true"),t=await e.json(),n=t.bitcoin.usd,s=t.bitcoin.usd_24h_change;btcPrice=n,document.getElementById("btc-price").textContent=n.toLocaleString();let d=document.getElementById("price-change"),o=`${s>0?"+":""}${s.toFixed(2)}%`;d.textContent=`${o} (24h)`,d.className=`text-lg ${s>0?"text-green-500":"text-red-500"}`,document.getElementById("last-updated").textContent=`Last updated: ${new Date().toLocaleTimeString()}`,isLoggedIn&&updatePortfolioValue()}catch(i){console.error("Error fetching Bitcoin price:",i),document.getElementById("btc-price").textContent="Price unavailable",document.getElementById("price-change").textContent="Unable to load data"}}function toggleMobileMenu(){let e=document.getElementById("mobile-menu");e.classList.toggle("hidden")}function closeMobileMenu(){document.getElementById("mobile-menu").classList.add("hidden")}function scrollToSection(e){document.getElementById(e).scrollIntoView({behavior:"smooth"})}function toggleFAQ(e){let t=document.getElementById(`faq-content-${e}`),n=document.getElementById(`faq-icon-${e}`);t.classList.toggle("hidden"),n.classList.toggle("rotate-180")}function showAuth(e){currentAuthMode=e;let t=document.getElementById("auth-modal"),n=document.getElementById("auth-title"),s=document.getElementById("auth-submit"),d=document.getElementById("auth-switch"),o=document.getElementById("register-fields");"login"===e?(n.textContent="Login",s.textContent="Login",d.textContent="Don't have an account? Sign up",o.classList.add("hidden")):(n.textContent="Sign Up",s.textContent="Create Account",d.textContent="Already have an account? Login",o.classList.remove("hidden")),t.classList.remove("hidden")}function closeAuth(){document.getElementById("auth-modal").classList.add("hidden"),document.getElementById("auth-form").reset()}function switchAuthMode(){let e="login"===currentAuthMode?"register":"login";showAuth(e)}async function handleAuth(i){i.preventDefault();let a=document.getElementById("email").value.trim(),l=document.getElementById("password").value.trim(),r=t(e,"users_new");if("register"===currentAuthMode){let c=document.getElementById("firstName").value.trim(),g=document.getElementById("lastName").value.trim();try{let u=d(r,o("email","==",a)),h=await s(u);if(!h.empty)return;let m={email:a,password:l,firstName:c,lastName:g,btcHoldings:0,portfolioValue:0};await n(r,m),currentUser=m,isLoggedIn=!0,updateAuthUI(),closeAuth(),updatePortfolioValue(),showDashboard()}catch(b){}}else try{let L=d(r,o("email","==",a),o("password","==",l)),y=await s(L);if(y.empty)return;let E=y.docs[0].data();currentUser=E,isLoggedIn=!0,updateAuthUI(),closeAuth(),updatePortfolioValue(),showDashboard()}catch(f){console.error("Login error:",f)}}function logout(){isLoggedIn=!1,currentUser=null,updateAuthUI(),showMainContent(),document.getElementById("nav-menu").classList.remove("hidden"),document.getElementById("auth-buttons").classList.remove("hidden"),document.getElementById("user-menu").classList.add("hidden")}function updateAuthUI(){let e=document.getElementById("auth-buttons"),t=document.getElementById("user-menu"),n=document.getElementById("user-name");isLoggedIn?(e.classList.add("hidden"),t.classList.remove("hidden"),currentUser&&(n.textContent=`${currentUser.firstName} ${currentUser.lastName}`)):(e.classList.remove("hidden"),t.classList.add("hidden"))}function showDashboard(){if(!isLoggedIn){showAuth("login");return}document.getElementById("main-content").classList.add("hidden");let e=document.getElementById("nav-menu");e.classList.add("hidden"),e.classList.remove("md:flex"),document.getElementById("auth-buttons").classList.add("hidden"),document.getElementById("user-menu").classList.remove("hidden"),document.getElementById("dashboard").classList.remove("hidden"),document.getElementById("mobile-menu-btn").classList.add("hidden"),showDashboardSection("overview")}function showMainContent(){document.getElementById("main-content").classList.remove("hidden");let e=document.getElementById("nav-menu");e.classList.remove("hidden"),e.classList.add("md:flex"),document.getElementById("auth-buttons").classList.remove("hidden"),document.getElementById("user-menu").classList.add("hidden"),document.getElementById("dashboard").classList.add("hidden"),document.getElementById("mobile-menu-btn").classList.remove("hidden")}function showDashboardSection(e){document.getElementById("dashboard-overview").classList.add("hidden"),document.getElementById("dashboard-deposit").classList.add("hidden"),document.getElementById("dashboard-withdraw").classList.add("hidden"),document.getElementById("dashboard-history").classList.add("hidden"),document.getElementById(`dashboard-${e}`).classList.remove("hidden");let t=document.querySelectorAll("#dashboard nav button");t.forEach(e=>{e.classList.remove("bg-yellow-500","text-black","font-medium"),e.classList.add("hover:bg-gray-700")}),event.target.classList.add("bg-yellow-500","text-black","font-medium"),event.target.classList.remove("hover:bg-gray-700")}function toggleDashboardDropdown(){let e=document.getElementById("dashboard-dropdown"),t=document.getElementById("dashboard-toggle-icon");e.classList.toggle("hidden"),e.classList.contains("hidden")?(t.classList.remove("fa-times"),t.classList.add("fa-bars")):(t.classList.remove("fa-bars"),t.classList.add("fa-times"))}function updatePortfolioValue(){currentUser&&btcPrice>0&&(currentUser.btcHoldings,document.getElementById("portfolio-value").textContent=0)}function copyAddress(){let e=document.getElementById("btc-address");e.select(),e.setSelectionRange(0,99999),navigator.clipboard.writeText(e.value).then(()=>{let e=event.target,t=e.innerHTML;e.innerHTML='<i class="fas fa-check"></i>',e.classList.add("bg-green-500"),e.classList.remove("bg-yellow-500"),setTimeout(()=>{e.innerHTML=t,e.classList.remove("bg-green-500"),e.classList.add("bg-yellow-500")},2e3)})}function handleContactForm(e){e.preventDefault(),e.target.reset()}document.addEventListener("DOMContentLoaded",function(){fetchBitcoinPrice(),setInterval(fetchBitcoinPrice,6e4),document.getElementById("mobile-menu-btn").addEventListener("click",toggleMobileMenu),document.getElementById("contact-form").addEventListener("submit",handleContactForm),document.getElementById("auth-form").addEventListener("submit",handleAuth),document.getElementById("auth-switch").addEventListener("click",switchAuthMode)}),document.addEventListener("DOMContentLoaded",function(){fetchBitcoinPrice(),setInterval(fetchBitcoinPrice,6e4),document.getElementById("mobile-menu-btn").addEventListener("click",toggleMobileMenu),document.getElementById("contact-form").addEventListener("submit",handleContactForm),document.getElementById("auth-form").addEventListener("submit",handleAuth),document.getElementById("auth-switch").addEventListener("click",switchAuthMode),isLoggedIn&&showDashboard()}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();let t=document.querySelector(this.getAttribute("href"));t&&t.scrollIntoView({behavior:"smooth"})})}),window.addEventListener("scroll",function(){let e=document.getElementById("navbar");window.scrollY>100?(e.classList.add("bg-gray-900"),e.classList.remove("bg-gray-900/95")):(e.classList.remove("bg-gray-900"),e.classList.add("bg-gray-900/95"))}),window.showAuth=showAuth,window.switchAuthMode=switchAuthMode,window.handleAuth=handleAuth,window.logout=logout,window.toggleMobileMenu=toggleMobileMenu,window.closeMobileMenu=closeMobileMenu,window.scrollToSection=scrollToSection,window.toggleFAQ=toggleFAQ,window.copyAddress=copyAddress,window.toggleDashboardDropdown=toggleDashboardDropdown,window.showDashboardSection=showDashboardSection;